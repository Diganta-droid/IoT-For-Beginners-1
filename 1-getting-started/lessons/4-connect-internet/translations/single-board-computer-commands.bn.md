# ржирж╛ржЗржЯрж▓рж╛ржЗржЯржЯрж┐ржХрзЗ ржЗржирзНржЯрж╛рж░ржирзЗржЯрзЗрж░ ржорж╛ржзрзНржпржорзЗ ржирж┐рзЯржирзНрждрзНрж░ржгржХрж░ржг тАУ ржнрж╛рж░рзНржЪрзБрзЯрж╛рж▓ ржЖржЗржУржЯрж┐ рж╣рж╛рж░рзНржбржУрзЯрзНржпрж╛рж░ ржПржмржВ рж░рж╛рж╕ржкржмрзЗрж░рж┐ ржкрж╛ржЗ

ржкрж╛ржарзЗрж░ ржПржЗ ржЕржВрж╢ржЯрж┐рждрзЗ  MQTT ржмрзНрж░рзЛржХрж╛рж░ рж╣рждрзЗ ржнрж╛рж░рзНржЪрзБрзЯрж╛рж▓ ржЖржЗржУржЯрж┐ ржбрж┐ржнрж╛ржЗрж╕ ржмрж╛ рж░рж╛рж╕ржкржмрзЗрж░рж┐ ржкрж╛ржЗ-рждрзЗ ржкрзНрж░рзЗрж░рж┐ржд ржХржорж╛ржирзНржбрж╕ржорзВрж╣рзЗ рж╕рж╛ржмрж╕рзНржХрзНрж░рж╛ржЗржм ржХрж░рж┐ ред
## ржХржорж╛ржирзНржбрж╕ржорзВрж╣рзЗ рж╕рж╛ржмрж╕рзНржХрзНрж░рж╛ржЗржм ржХрж░рж┐

ржкрж░ржмрж░рзНрждрзА ржзрж╛ржк рж╣ржЪрзНржЫрзЗ MQTT ржмрзНрж░рзЛржХрж╛рж░ рж╣рждрзЗ ржкрзНрж░рзЗрж░рж┐ржд ржХржорж╛ржирзНржбрж╕ржорзВрж╣рзЗ рж╕рж╛ржмрж╕рзНржХрзНрж░рж╛ржЗржм ржХрж░рж╛ ржПржмржВ рж╕рзЗржЗ ржЕржирзБржпрж╛рзЯрзА рж╕рж╛рзЬрж╛ ржжрзЗржУрзЯрж╛ ред

### ржХрж╛ржЬ

ржХржорж╛ржирзНржбрж╕ржорзВрж╣рзЗ рж╕рж╛ржмрж╕рзНржХрзНрж░рж╛ржЗржм ржХрж░рж┐ред
1. VS Code-ржП ржирж╛ржЗржЯрж▓рж╛ржЯ ржкрзНрж░ржЬрзЗржХрзНржЯржЯрж┐ ржУржкрзЗржи ржХрж░рж┐ред

1. ржпржжрж┐ ржнрж╛рж░рзНржЪрзБрзЯрж╛рж▓ ржЖржЗржУржЯрж┐ ржбрж┐ржнрж╛ржЗрж╕ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж┐ рждржмрзЗ ржЯрж╛рж░рзНржорж┐ржирж╛рж▓рзЗ ржнрж╛рж░рзНржЪрзБрзЯрж╛рж▓ ржПржиржнрж╛рзЯрж░ржиржорзЗржирзНржЯ ржЪрж╛рж▓рзБрж░ржд ржЖржЫрзЗ ржХрж┐ржирж╛ рждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░ржмрзЛред

1. `client_telemetry_topic`-ржбрзЗржлрж┐ржирзЗрж╢ржиржЯрж┐рж░ ржкрж░ ржирж┐ржЪрзЗрж░ ржХрзЛржбржЯрж┐ ржПржб ржХрж░рж┐ред

    ```python
    server_command_topic = id + '/commands'
    ```

   `server_command_topic` ржПржХржЯрж┐ MQTT ржЯржкрж┐ржХ ржпрж╛ LED рж╣рждрзЗ ржХржорж╛ржирзНржбрж╕ржорзВрж╣ ржЧрзНрж░рж╣ржгрзЗрж░ ржЬржирзНржп ржбрж┐ржнрж╛ржЗрж╕ржЯрж┐ ржПржЗ MQTT ржЯржкрж┐ржХрзЗ рж╕рж╛ржмрж╕рзНржХрзНрж░рж╛ржЗржм ржХрж░ржмрзЗред

1. `mqtt_client.loop_start()` рж▓рж╛ржЗржиржЯрж┐рж░ ржкрж░ main рж▓рзБржкрзЗрж░ ржарж┐ржХ ржЙржкрж░рзЗ ржирж┐ржЪрзЗрж░ ржХрзЛржбржЯрж┐ ржПржб ржХрж░рж┐ред

    ```python
    def handle_command(client, userdata, message):
        payload = json.loads(message.payload.decode())
        print("Message received:", payload)
    
        if payload['led_on']:
            led.on()
        else:
            led.off()
    
    mqtt_client.subscribe(server_command_topic)
    mqtt_client.on_message = handle_command
    ```

    ржПржЗ ржХрзЛржбржЯрж┐ `handle_command` ржлрж╛ржВрж╢ржиржЯрж┐ржХрзЗ рж╕ржВржЬрзНржЮрж╛рзЯрж┐ржд ржХрж░рзЗ ржпрж╛ ржПржХржЯрж┐ ржорзЗрж╕рзЗржЬржХрзЗ JSON ржбржХрзБржорзЗржирзНржЯ рж╣рж┐рж╕рзЗржмрзЗ ржкрзЬрждрзЗ ржкрж╛рж░рзЗ ржПржмржВ рждрж╛рждрзЗ `led_on` ржкрзНрж░рзЛржкрж╛рж░рзНржЯрж┐рж░ ржнрзНржпрж╛рж▓рзБрж░ ржЦрзЛржЬ ржХрж░рзЗ ред ржпржжрж┐ ржнрзНржпрж╛рж▓рзБржЯрж┐ `True`-рждрзЗ рж╕рзЗржЯ ржХрж░рж╛ ржерж╛ржХрзЗ рждржмрзЗ LED ржЬрж╝рзНржмрж▓ржмрзЗ ржЕржирзНржпржерж╛рзЯ ржмржирзНржз ржерж╛ржХржмрзЗред

    рж╕рж╛рж░рзНржнрж╛рж░ ржпрзЗ ржЯржкрж┐ржХрзЗ ржорзЗрж╕рзЗржЬ ржкрзНрж░рзЗрж░ржг ржХрж░ржмрзЗ MQTT ржХрзНрж▓рж╛рзЯрзЗржирзНржЯ рж╕рзЗржЗ ржЯржкрж┐ржХрзЗ рж╕рж╛ржмрж╕рзНржХрзНрж░рж╛ржЗржм ржХрж░ржмрзЗ ржПржмржВ ржПржЗ ржорзЗрж╕рзЗржЬржЯрж┐ ржпржЦржи рж░рж┐рж╕рж┐ржн рж╣ржмрзЗ рждржЦржи  `handle_command` ржлрж╛ржВрж╢ржиржЯрж┐ ржХрж▓ ржХрж░рж╛рж░ ржЬржирзНржп рж╕рзЗржЯ ржХрж░рж╛ рж╣ржмрзЗред 

    > ЁЯТБ `on_message` рж╣рзНржпрж╛ржирзНржбрж▓рж╛рж░ржЯрж┐ рж╕ржХрж▓ ржЯржкрж┐ржХрзЗ рж╕рж╛ржмрж╕рзНржХрзНрж░рж╛ржЗржмрзЗрж░ ржЬржирзНржп ржХрж▓ ржХрж░рж╛ рж╣рзЯред ржпржжрж┐ ржкрж░ржмрж░рзНрждрзАрждрзЗ ржПржХрж╛ржзрж┐ржХ ржЯржкрж┐ржХ рж╣рждрзЗ ржЧрзНрж░рж╣ржгрзЗрж░ ржХрзЛржбржЯрж┐ рж▓рж┐ржЦрзЗ ржерж╛ржХрж┐ рждржмрзЗ ржпрзЗ ржЯржкрж┐ржХрзЗрж░ ржорзЗрж╕рзЗржЬржЯрж┐ `message` ржЕржмржЬрзЗржХрзНржЯ ржерзЗржХрзЗ рж╣рзНржпрж╛ржирзНржбрж▓рж╛рж░ ржлрж╛ржВрж╢ржирзЗ ржкрзНрж░рзЗрж░ржг ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрж┐рж▓ рждрж╛ржХрзЗ ржкрж╛ржУрзЯрж╛ ржпрж╛ржмрзЗред

1. ржкрзВрж░рзНржмржмрж░рзНрждрзА ржПрж╕рж╛ржЗржорзЗржирзНржЯ ржЕржВрж╢рзЗрж░ ржХрзЛржбржЯрж┐ржХрзЗ ржпрзЗржнрж╛ржмрзЗ рж░рж╛ржи ржХрж░рзЗржЫрж┐ ржарж┐ржХ ржПржХржЗржнрж╛ржмрзЗ ржПржЗ ржХрзЛржбржЯрж┐ржХрзЗ рж░рж╛ржи ржХрж░рж┐ред ржпржжрж┐ ржнрж╛рж░рзНржЪрзБрзЯрж╛рж▓ ржЖржЗржУржЯрж┐ ржбрж┐ржнрж╛ржЗрж╕ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж┐ рждржмрзЗ CounterFit ржПржкржЯрж┐ рж░рж╛ржирж┐ржВ ржЕржмрж╕рзНржерж╛рзЯ ржЖржЫрзЗ ржХрж┐ржирж╛ ржПржмржВ рж▓рж╛ржЗржЯ рж╕рзЗржирзНрж╕рж░, ржПрж▓ржЗржбрж┐ рж╕ржарж┐ржХ ржкрж┐ржирзЗ ржЖржЫрзЗ ржХрж┐ржирж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░ржмрзЛред 

1. ржмрж╛рж╣рзНржпрж┐ржХ ржмрж╛ ржнрж╛рж░рзНржЪрзБрзЯрж╛рж▓ ржбрж┐ржнрж╛ржЗрж╕ ржХрждрзГржХ рж╕ржирж╛ржХрзНрждржХрзГржд рж▓рж╛ржЗржЯ рж▓рзЗржнрзЗрж▓рзЗрж░ рж╕рж╛ржоржЮрзНржЬрж╕рзНржпрждрж╛ ржмржЬрж╛рзЯ рж░рж╛ржЦрж┐ред ржЧрзГрж╣рзАржд ржорзЗрж╕рзЗржЬрж╕ржорзВрж╣ ржПржмржВ ржкрзНрж░рзЗрж░рж┐ржд ржХржорж╛ржирзНржбрж╕ржорзВрж╣ ржЯрж╛рж░рзНржорж┐ржирж╛рж▓рзЗ рж▓рж┐ржЦрж┐ржд рж╣ржмрзЗред рж▓рж╛ржЗржЯрзЗрж░ рж▓рзЗржнрзЗрж▓рзЗрж░ ржЙржкрж░ ржнрж┐рждрзНрждрж┐ ржХрж░рзЗ ржПрж▓ржЗржбрж┐ ржЕржи ржмрж╛ ржЕржл рж╣ржмрзЗред 

> ЁЯТБ ржХрзЛржбржЯрж┐ ржПржЗ [code-commands/virtual-device](code-commands/virtual-device) ржлрзЛрж▓рзНржбрж╛рж░рзЗ ржмрж╛ ржПржЗ [code-commands/pi](code-commands/pi) ржлрзЛрж▓рзНржбрж╛рж░рзЗ ржкрж╛ржмрзЛ ред

ЁЯША MQTT ржмрзНрж░рзЛржХрж╛рж░рзЗрж░ ржХржорж╛ржирзНржбрж╕ржорзВрж╣ ржЕржирзБрж╕рж╛рж░рзЗ ржЖржорж╛ржжрзЗрж░ ржбрж┐ржнрж╛ржЗрж╕рзЗрж░ рж╕рж╛рзЬрж╛ ржжрзЗржУрзЯрж╛рж░ ржЬржирзНржп ржЖржорж░рж╛ рж╕ржлрж▓ржнрж╛ржмрзЗ ржХрзЛржбржЯрж┐ ржХрж░рзЗржЫрж┐ред
