# ржирж╛ржЗржЯрж▓рж╛ржЗржЯржЯрж┐ржХрзЗ ржЗржирзНржЯрж╛рж░ржирзЗржЯрзЗрж░ ржорж╛ржзрзНржпржорзЗ ржирж┐рзЯржирзНрждрзНрж░ржгржХрж░ржг тАУ ржнрж╛рж░рзНржЪрзБрзЯрж╛рж▓ ржЖржЗржУржЯрж┐ рж╣рж╛рж░рзНржбржУрзЯрзНржпрж╛рж░ ржПржмржВ рж░рж╛рж╕ржкржмрзЗрж░рж┐ ржкрж╛ржЗ

MQTT ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ *test.mosquitto.org* ржПрж░ рж╕рж╛ржерзЗ ржЖржЗржУржЯрж┐ ржбрж┐ржнрж╛ржЗрж╕рзЗрж░ рж╕ржВржпрзЛржЧ рж╕рзНржерж╛ржкржирзЗрж░ ржорж╛ржзрзНржпржорзЗ рж▓рж╛ржЗржЯ рж╕рзЗржирзНрж╕рж░рзЗрж░ ржЯрзЗрж▓рж┐ржорзЗржЯрзНрж░рж┐ рж░рж┐ржбрж┐ржВржЧрзБрж▓рзЛ ржкрзНрж░рзЗрж░ржг ржХрж░рж╛ ржПржмржВ ржХржорж╛ржирзНржбрж╕ржорзВрж╣ ржЧрзНрж░рж╣ржгрзЗрж░ ржорж╛ржзрзНржпржорзЗ ржПрж▓ржЗржбрж┐-ржХрзЗ ржирж┐рзЯржирзНрждрзНрж░ржгрзЗрж░ ржЬржирзНржп ржЖржЗржУржЯрж┐ ржбрж┐ржнрж╛ржЗрж╕ржЯрж┐ржХрзЗ ржХрзЛржб ржХрж░рж╛ ржкрзНрж░рзЯрзЛржЬржиред

ржкрж╛ржарзЗрж░ ржПржЗ ржЕржВрж╢ржЯрж┐рждрзЗ рж░рж╛рж╕ржкржмрзЗрж░рж┐ ржкрж╛ржЗ ржмрж╛ ржнрж╛рж░рзНржЪрзБрзЯрж╛рж▓ ржЖржЗржУржЯрж┐ ржбрж┐ржнрж╛ржЗрж╕рзЗрж░ рж╕рж╛ржерзЗ MQTT ржмрзНрж░рзЛржХрж╛рж░рзЗрж░ рж╕ржВржпрзЛржЧ рж╕рзНржерж╛ржкржи ржХрж░ржмрзЛред 

## MQTT ржХрзНрж▓рж╛рзЯрзЗржирзНржЯ ржкрзНржпрж╛ржХрзЗржЬржЯрж┐ ржЗржирзНрж╕ржЯрж▓ ржХрж░рж┐ 

MQTT ржмрзНрж░рзЛржХрж╛рж░рзЗрж░ рж╕рж╛ржерзЗ рж╕ржВржпрзЛржЧ рж╕рзНржерж╛ржкржи ржХрж░рждрзЗ ржкрж╛ржЗрждрзЗ ржмрж╛ ржнрж╛рж░рзНржЪрзБрзЯрж╛рж▓ ржбрж┐ржнрж╛ржЗрж╕рзЗрж░ ржнрж╛рж░рзНржЪрзБрзЯрж╛рж▓ ржЗржиржнрж╛рзЯрж░ржиржорзЗржирзНржЯрзЗ MQTT рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ ржкрж┐ржк ржкрзНржпрж╛ржХрзЗржЬ ржЗржирзНрж╕ржЯрж▓ ржХрж░рзЗ ржирж┐рждрзЗ рж╣ржмрзЗред 

### ржХрж╛ржЬ

ржкрж┐ржк ржкрзНржпрж╛ржХрзЗржЬ ржЗржирзНрж╕ржЯрж▓ ржХрж░рж┐ 

1. VS Code-ржП ржирж╛ржЗржЯрж▓рж╛ржЗржЯ ржкрзНрж░ржЬрзЗржХрзНржЯржЯрж┐ ржУржкрзЗржи ржХрж░рж┐ред

1. ржпржжрж┐ ржнрж╛рж░рзНржЪрзБрзЯрж╛рж▓ ржЖржЗржУржЯрж┐ ржбрж┐ржнрж╛ржЗрж╕ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж┐ рждржмрзЗ рж╕рзЗржХрзНрж╖рзЗрждрзНрж░рзЗ ржЯрж╛рж░рзНржорж┐ржирж╛рж▓ ржнрж╛рж░рзНржЪрзБрзЯрж╛рж▓ ржЗржиржнрж╛рзЯрж░ржиржорзЗржирзНржЯрзЗ рж░рж╛ржи рж╣ржЪрзНржЫрзЗ ржХрж┐ржирж╛ рждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рж┐ред

1. MQTT ржкрж┐ржк ржкрзНржпрж╛ржХрзЗржЬржЯрж┐ ржЗржирзНрж╕ржЯрж▓ ржХрж░рждрзЗ ржирж┐ржЪрзЗрж░ ржХрзЛржбржЯрж┐ рж░рж╛ржи ржХрж░рж┐ржГ

    ```sh
    pip3 install paho-mqtt
    ```

## ржбрж┐ржнрж╛ржЗрж╕ржЯрж┐ржХрзЗ ржХрзЛржб ржХрж░рж┐

ржбрж┐ржнрж╛ржЗрж╕ржЯрж┐ ржХрзЛржбрзЗрж░ ржЬржирзНржп ржкрзНрж░рж╕рзНрждрзБрждред

### ржХрж╛ржЬ

ржбрж┐ржнрж╛ржЗрж╕ ржХрзЛржбржЯрж┐ рж▓рж┐ржЦрж┐ред

1. ржирж┐ржорзНржирзЗрж░ import ржХрзЛржбржЯрж┐ржХрзЗ `app.py` ржлрж╛ржЗрж▓рзЗрж░ ржЙржкрж░рзЗ ржПржб ржХрж░рж┐ржГ

    ```python
    import paho.mqtt.client as mqtt
    ```

    `paho.mqtt.client` рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ржЯрж┐ ржПржкржЯрж┐ржХрзЗ MQTT ржПрж░ ржорж╛ржзрзНржпржорзЗ рж╕ржВржпрзЛржЧ рж╕рзНржерж╛ржкржирзЗрж░ ржЕржирзБржорждрж┐ ржкрзНрж░ржжрж╛ржи ржХрж░рзЗред

1. рж▓рж╛ржЗржЯ рж╕рзЗржирзНрж╕рж░ ржПржмржВ ржПрж▓ржЗржбрж┐ ржбрж┐ржлрж┐ржирзЗрж╢ржирзЗрж░ ржкрж░ ржирж┐ржЪрзЗрж░ ржХрзЛржбржЯрж┐ ржПржб ржХрж░рж┐ржГ

    ```python
    id = '<ID>'

    client_name = id + 'nightlight_client'
    ```

   `<ID>`ржЯрж┐ ржПржХржЯрж┐ ржЗржЙржирж┐ржХ ржЖржЗржбрж┐ ржжрзНржмрж╛рж░рж╛ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи ржХрж░рж┐ ржпрж╛ ржбрж┐ржнрж╛ржЗрж╕ ржХрзНрж▓рж╛рзЯрзЗржирзНржЯрзЗрж░ ржирж╛ржо ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗ ржПржмржВ ржкрж░ржмрж░рзНрждрзАрждрзЗ ржЯржкрж┐ржХрж╕ржорзВрж╣рзЗ ржкрж╛ржмрж▓рж┐рж╢ ржЖрж░ рж╕рж╛ржмрж╕рзНржХрзНрж░рж╛ржЗржмрзЗрж░ ржЬржирзНржп ржмрзНржпржмрж╣рзГржд рж╣ржмрзЗред*test.mosquitto.org* ржПржЯрж┐ ржПржХржЯрж┐ ржкрж╛ржмрж▓рж┐ржХ ржмрзНрж░рзЛржХрж╛рж░ ржпрж╛ ржПржЗ ржПрж╕рж╛ржЗржиржорзЗржирзНржЯ рж╕ржорзНржкрж╛ржжржирзЗ ржпрзБржХрзНржд ржЕржирзНржпрж╛ржирзНржп рж╢рж┐ржХрзНрж╖рж╛рж░рзНржерзАржжрзЗрж░ рж╕рж╣ ржЕржирзЗржХ ржорж╛ржирзБрж╖рзЗрж░ ржжрзНржмрж╛рж░рж╛ ржмрзНржпржмрж╣рзГржд рж╣рзЯред ржЗржЙржирж┐ржХ MQTT ржХрзНрж▓рж╛рзЯрзЗржирзНржЯрзЗрж░ ржирж╛ржо ржПржмржВ ржЗржЙржирж┐ржХ ржЯржкрж┐ржХрзЗрж░ ржирж╛ржо ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ ржпрзЗ ржПржХржЬржирзЗрж░ ржХрзЛржбржЯрж┐ ржЖрж░рзЗржХржЬржирзЗрж░ ржХрзЛржбрзЗрж░ рж╕рж╛ржерзЗ ржмрж┐ржмрж╛ржжрзЗ ржЬрзЬрж╛ржмрзЗ ржирж╛ред ржпржЦржи ржПржЗ ржЕрзНржпрж╛рж╕рж╛ржЗржиржорзЗржирзНржЯрзЗрж░ ржкрж░рзЗ рж╕рж╛рж░рзНржнрж╛рж░ ржХрзЛржб рждрзИрж░рж┐ ржХрж░ржмрзЛ рждржЦржи ржПржЗ ржЖржЗржбрж┐рж░ ржкрзНрж░ржпрж╝рзЛржЬржи рж╣ржмрзЗред

    > ЁЯТБ ржПржЗ [GUIDGen](https://www.guidgen.com) ржУрзЯрзЗржмрж╕рж╛ржЗржЯржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржХржЯрж┐ ржЗржЙржирж┐ржХ ржЖржЗржбрж┐ ржмрж╛ржирж╛рждрзЗ ржкрж╛рж░ржмрзЛред

    ржмрзНрж░рзЛржХрж╛рж░рзЗ ржПржЗ MQTT ржХрзНрж▓рж╛рзЯрзЗржирзНржЯрзЗрж░ ржЬржирзНржп `client_name` ржПржХржЯрж┐ ржЗржЙржирж┐ржХ ржирж╛ржоред

1. MQTT ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ ржЕржмржЬрзЗржХрзНржЯ рждрзИрж░рж┐ ржХрж░рждрзЗ ржПржмржВ MQTT ржмрзНрж░рзЛржХрж╛рж░рзЗрж░ рж╕рж╛ржерзЗ рж╕ржВржпрзЛржЧ рж╕рзНржерж╛ржкржи ржХрж░рждрзЗ ржПржЗ ржирждрзБржи ржХрзЛржбрзЗрж░ ржирж┐ржЪрзЗ ржирж┐ржорзНржирзЗрж░ ржХрзЛржбржЯрж┐ ржПржб ржХрж░рж┐ржГ

    ```python
    mqtt_client = mqtt.Client(client_name)
    mqtt_client.connect('test.mosquitto.org')
    
    mqtt_client.loop_start()

    print("MQTT connected!")
    ```

    ржПржЗ ржХрзЛржбржЯрж┐ ржХрзНрж▓рж╛рзЯрзЗржирзНржЯ ржЕржмржЬрзЗржХрзНржЯ рждрзИрж░рж┐ ржХрж░рзЗ ржпрж╛ ржкрж╛ржмрж▓рж┐ржХ MQTT ржмрзНрж░рзЛржХрж╛рж░рзЗрж░ рж╕рж╛ржерзЗ рж╕ржВржпрзБржХрзНржд рж╣рзЯ ржПржмржВ рж╕рж╛ржмрж╕рзНржХрзНрж░рж╛ржЗржм ржХрж░рж╛ ржорзЗрж╕рзЗржЬрж╕ржорзВрж╣ ржЧрзНрж░рж╣ржгрзЗрж░ ржЬржирзНржп ржПржХржЯрж┐ рж▓рзБржк ржкрзНрж░рж╕рзЗрж╕рж┐ржВ ржХрж░рзЗ ржпрж╛ ржмрзНржпрж╛ржХржЧрзНрж░рж╛ржЙржирзНржб ржерзНрж░рзЗржбрзЗ рж░рж╛ржи ржЕржмрж╕рзНржерж╛рзЯ ржерж╛ржХрзЗред

1. ржкрзВрж░рзНржмржмрж░рзНрждрзА ржПрж╕рж╛ржЗржорзЗржирзНржЯ ржЕржВрж╢рзЗрж░ ржХрзЛржбржЯрж┐ржХрзЗ ржпрзЗржнрж╛ржмрзЗ рж░рж╛ржи ржХрж░рзЗржЫрж┐ ржарж┐ржХ ржПржХржЗржнрж╛ржмрзЗ ржПржЗ ржХрзЛржбржЯрж┐ржХрзЗ рж░рж╛ржи ржХрж░рж┐ред ржпржжрж┐ ржнрж╛рж░рзНржЪрзБрзЯрж╛рж▓ ржЖржЗржУржЯрж┐ ржбрж┐ржнрж╛ржЗрж╕ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж┐ рждржмрзЗ CounterFit ржПржкржЯрж┐ рж░рж╛ржирж┐ржВ ржЕржмрж╕рзНржерж╛рзЯ ржЖржЫрзЗ ржХрж┐ржирж╛ ржПржмржВ рж▓рж╛ржЗржЯ рж╕рзЗржирзНрж╕рж░, ржПрж▓ржЗржбрж┐ рж╕ржарж┐ржХ ржкрж┐ржирзЗ ржЖржЫрзЗ ржХрж┐ржирж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░ржмрзЛред

    ```output
    (.venv) тЮЬ  nightlight python app.py 
    MQTT connected!
    Light level: 0
    Light level: 0
    ```

> ЁЯТБ ржХрзЛржбржЯрж┐ ржПржЗ [code-mqtt/virtual-device](code-mqtt/virtual-device) ржлрзЛрж▓рзНржбрж╛рж░рзЗ ржмрж╛ ржПржЗ [code-mqtt/pi](code-mqtt/pi) ржлрзЛрж▓рзНржбрж╛рж░рзЗ ржкрж╛ржмрзЛ ред

ЁЯША ржбрж┐ржнрж╛ржЗрж╕ржЯрж┐ржХрзЗ MQTT ржмрзНрж░рзЛржХрж╛рж░рзЗрж░ рж╕рж╛ржерзЗ рж╕ржлрж▓ржнрж╛ржмрзЗ рж╕ржВржпрзБржХрзНржд ржХрж░рждрзЗ ржкрзЗрж░рзЗржЫрж┐ред
